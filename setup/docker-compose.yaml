# docker-compose up â€“build
# Access to backbone js frontend http://127.0.0.1/
# The rails backend is only accessible from reverse_proxy in backbonejs nginx (see ngnix.conf)
# Access to Postgres Admin http://127.0.0.1:8081/

version: "3.7"
services:
    db:
        image: postgres:12.1-alpine
        env_file: .env
        networks: 
            - backend
    dbadmin:
        image: dpage/pgadmin4
        volumes:
            - ./pgadminserver.json:/pgadmin4/servers.json
        ports:
            - "8081:8080"
        depends_on:
            - db
        env_file: .env
        networks: 
            - backend
    rails:
        build: ./build_rails
        image: rails_backend #Name of the image built by the build instruction
        volumes:
            - ./build_rails/backend/:/transcendence
        depends_on:
            - db
        env_file: .env
        networks: 
            - backend
            - frontend
    backbonejs:
        build: ./build_backbonejs
        image: backbonejs_frontend
        volumes:
            - ./build_backbonejs/frontend/:/transcendence
        ports:
            - "80:80"
        depends_on:
            - rails
        networks:
            - backend
            - frontend
networks:
    frontend:
    backend: